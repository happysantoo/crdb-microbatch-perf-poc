# VajraPulse HTML Report Integration

## Overview

Replaced custom HTML report generation with VajraPulse's built-in `HtmlReportExporter` from the `vajrapulse-exporter-report` module.

## Changes Made

### 1. Added Dependency

**File**: `build.gradle.kts`

```kotlin
implementation("com.vajrapulse:vajrapulse-exporter-report:0.9.5")
```

### 2. Updated LoadTestService

**File**: `src/main/java/com/crdb/microbatch/service/LoadTestService.java`

#### Added Import
```java
import com.vajrapulse.exporter.report.HtmlReportExporter;
```

#### Added Constants
```java
private static final String REPORT_DIR = "reports";
private static final String REPORT_FILE = "crdb-microbatch-load-test-report.html";
```

#### Created HtmlReportExporter
```java
private HtmlReportExporter createHtmlReportExporter() {
    Path reportPath = Paths.get(REPORT_DIR, REPORT_FILE);
    return new HtmlReportExporter(reportPath, meterRegistry);
}
```

#### Updated Pipeline Creation
```java
private MetricsPipeline createMetricsPipeline(OpenTelemetryExporter otelExporter, HtmlReportExporter htmlExporter) {
    return MetricsPipeline.builder()
        .addExporter(otelExporter)
        .addExporter(htmlExporter)  // Added HTML exporter
        .withRunId(otelExporter.getRunId())
        .withPeriodic(Duration.ofSeconds(EXPORT_INTERVAL_SECONDS))
        .withPercentiles(0.5, 0.9, 0.95, 0.99)
        .build();
}
```

#### Removed Custom HTML Generation
- Removed `generateHtmlReport()` method (100+ lines)
- Removed `generateHtmlContent()` method (70+ lines)
- Removed unused imports (`Files`, `LocalDateTime`, `DateTimeFormatter`, `IOException`)

#### Simplified Final Report
```java
private void generateFinalReport(Object result) {
    try {
        long finalCount = repository.getCount();
        printFinalSummary(finalCount, result);
        log.info("HTML report generated by VajraPulse HtmlReportExporter: {}/{}", REPORT_DIR, REPORT_FILE);
    } catch (Exception e) {
        log.error("Failed to generate final report", e);
    }
}
```

## Benefits

1. **Less Code**: Removed ~170 lines of custom HTML generation code
2. **Better Reports**: VajraPulse's `HtmlReportExporter` includes:
   - Interactive charts using Chart.js
   - Summary cards with key metrics
   - Detailed metrics tables
   - Percentile graphs for latency
   - Adaptive pattern metrics (if available)
   - Professional styling
3. **Maintenance**: No need to maintain custom HTML templates
4. **Consistency**: Uses the same reporting format as other VajraPulse users
5. **Features**: Automatically includes all VajraPulse metrics

## Report Location

Reports are generated at: `reports/crdb-microbatch-load-test-report.html`

The report is automatically generated by the `HtmlReportExporter` when the pipeline completes.

## Report Contents

The VajraPulse HTML report includes:

1. **Summary Cards**:
   - Total Executions
   - Success Rate
   - Response TPS
   - Failure Rate

2. **Detailed Metrics Table**:
   - Total Executions
   - Successful/Failed counts and percentages
   - Response/Success/Failure TPS
   - Queue Size

3. **Latency Charts**:
   - Success Latency (percentiles)
   - Failure Latency (percentiles)
   - Interactive Chart.js visualizations

4. **Adaptive Pattern Metrics** (if using AdaptiveLoadPattern):
   - TPS over time
   - Load adjustments

5. **Metadata**:
   - Generation timestamp
   - Elapsed time
   - Run ID

## Migration Notes

- Custom HTML generation code has been completely removed
- Report location is now fixed: `reports/crdb-microbatch-load-test-report.html`
- Report is automatically generated by the pipeline - no manual invocation needed
- Console summary still printed for quick reference

